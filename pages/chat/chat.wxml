<view class="chat-page">
  <view class="fixed-header">
    <view class="header">
      <view class="header-texts">
        <text class="greeting">{{greeting}}</text>
        <text class="subtext">{{welcomStr}}</text>
      </view>
      <view class="header-illustration">
        <image class="avatar-image" src="/images/gift.png" mode="aspectFill"></image>
      </view>
    </view>
  </view>

  <scroll-view class="chat-scroll {{hasPills ? '' : 'no-pills'}}" scroll-y="true" scroll-with-animation="true" scroll-into-view="{{scrollInto}}">
    <view class="messages">
      <block wx:for="{{messages}}" wx:key="index">
        <block wx:if="{{item.type === 'cta'}}">
          <view class="cta-wrap">
            <button class="cta-btn" bindtap="onStartMatch">
              <text class="gift-icon">🎁</text>
              <text class="btn-text">开启礼物匹配 →</text>
            </button>
            <text class="cta-caption">已了解你的心意，准备好为您推荐</text>
          </view>
        </block>
        <block wx:else>
          <view id="msg-{{index}}" class="bubble {{item.role === 'user' ? 'right' : 'left'}}">
            <block wx:if="{{item.typing}}">
              <view class="typing">
                <view class="dot"></view>
                <view class="dot"></view>
                <view class="dot"></view>
              </view>
            </block>
            <block wx:else>
              <text>{{item.content}}</text>
            </block>
          </view>
        </block>
      </block>
      <view id="end-anchor" class="end-anchor"></view>
    </view>
  </scroll-view>

  <view class="fixed-footer {{hasPills ? '' : 'no-pills'}}">
    <view class="footer-bg"></view>
    <view class="secondary-actions" wx:if="{{hasPills}}">
      <view class="pill blue" bindtap="onMyGifts" wx:if="{{showMyGifts}}">
        <text class="pill-icon">🎁</text>
        <text class="pill-text">我的礼赠</text>
      </view>
      <view class="pill orange" bindtap="onGiftHistory" wx:if="{{showGiftHistory}}">
        <text class="pill-icon">🕒</text>
        <text class="pill-text">礼赠历史</text>
      </view>
    </view>

    <view class="input-area">
      <input class="input" placeholder="请输入消息…" value="{{inputValue}}" bindinput="onInput" confirm-type="send" bindconfirm="onSend" />
      <view class="send-btn" bindtap="onSend">
        <text class="send-icon">➤</text>
      </view>
    </view>
  </view>
</view>
